<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Gestion Admin</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    color: #2c3e50;
    line-height: 1.6;
    min-height: 100vh;
    padding: 2rem 1rem;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
  }

  h1 {
    font-size: 2.5rem;
    font-weight: 300;
    color: #2c3e50;
    margin-bottom: 2rem;
    text-align: center;
    letter-spacing: -0.02em;
  }

  .card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 30px rgba(0,0,0,0.08);
    border: 1px solid #e9ecef;
    overflow: hidden;
  }

  .card-header {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    color: white;
    padding: 1.5rem 2rem;
    border: none;
  }

  .card-header h5 {
    font-size: 1.4rem;
    font-weight: 400;
    margin: 0;
  }

  .card-body {
    padding: 2rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #2c3e50;
    font-size: 0.95rem;
  }

  .form-control, .form-select {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
  }

  .form-control:focus, .form-select:focus {
    outline: none;
    border-color: #495057;
    box-shadow: 0 0 0 3px rgba(73, 80, 87, 0.1);
  }

  .form-control:hover, .form-select:hover {
    border-color: #ced4da;
  }

  .form-text {
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 0.25rem;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .day-schedule {
    border: 2px solid #f8f9fa;
    border-radius: 12px;
    padding: 1.5rem;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    margin-bottom: 1rem;
    transition: all 0.3s ease;
  }

  .day-schedule:hover {
    border-color: #e9ecef;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
  }

  .day-schedule strong {
    display: block;
    font-size: 1.1rem;
    color: #2c3e50;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #f1f3f4;
  }

  .creneau {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
    padding: 0.5rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #f1f3f4;
    transition: all 0.2s ease;
  }

  .creneau:hover {
    background: #f8f9fa;
    border-color: #e9ecef;
  }

  .creneau input[type="time"] {
    flex: 1;
    padding: 0.5rem 0.75rem;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    font-size: 0.9rem;
  }

  .creneau span {
    color: #6c757d;
    font-weight: 500;
    font-size: 0.9rem;
  }

  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-primary {
    background: linear-gradient(135deg, #495057 0%, #2c3e50 100%);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(73, 80, 87, 0.3);
  }

  .btn-secondary {
    background: #f8f9fa;
    color: #495057;
    border: 2px solid #e9ecef;
  }

  .btn-secondary:hover {
    background: #e9ecef;
    border-color: #ced4da;
  }

  .btn-outline-primary {
    background: transparent;
    color: #495057;
    border: 1px solid #e9ecef;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }

  .btn-outline-primary:hover {
    background: #495057;
    color: white;
    border-color: #495057;
  }

  .btn-danger {
    background: #dc3545;
    color: white;
    padding: 0.25rem 0.5rem;
    font-size: 0.8rem;
    border-radius: 4px;
  }

  .btn-danger:hover {
    background: #c82333;
  }

  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }

  .alert {
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border: none;
    position: relative;
    overflow: hidden;
  }

  .alert::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: currentColor;
  }

  .alert-success {
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
    color: #155724;
  }

  .alert-danger {
    background: linear-gradient(135deg, #f8d7da 0%, #f1b0b7 100%);
    color: #721c24;
  }

  .alert-warning {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    color: #856404;
  }

  .alert-info {
    background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
    color: #0c5460;
  }

  .btn-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    color: inherit;
    opacity: 0.7;
  }

  .btn-close:hover {
    opacity: 1;
  }

  .spinner-border {
    width: 1rem;
    height: 1rem;
    border: 2px solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spinner-border 0.75s linear infinite;
  }

  @keyframes spinner-border {
    to { transform: rotate(360deg); }
  }

  .loading {
    display: none;
  }

  .form-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #f1f3f4;
  }

  .fade {
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .fade.show {
    opacity: 1;
  }

  /* Responsive */
  @media (max-width: 768px) {
    body {
      padding: 1rem 0.5rem;
    }

    h1 {
      font-size: 2rem;
    }

    .card-body {
      padding: 1.5rem;
    }

    .row {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .creneau {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .form-actions {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Animations d'entr√©e */
  .day-schedule {
    animation: fadeInUp 0.6s ease forwards;
  }

  .day-schedule:nth-child(1) { animation-delay: 0.1s; }
  .day-schedule:nth-child(2) { animation-delay: 0.2s; }
  .day-schedule:nth-child(3) { animation-delay: 0.3s; }
  .day-schedule:nth-child(4) { animation-delay: 0.4s; }
  .day-schedule:nth-child(5) { animation-delay: 0.5s; }
  .day-schedule:nth-child(6) { animation-delay: 0.6s; }
  .day-schedule:nth-child(7) { animation-delay: 0.7s; }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Style pour les champs hidden */
  .field-hidden {
    display: none;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }

  .field-visible {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }
</style>
</head>
<body>

<div class="container">
  <h1>Gestion Administrative</h1>

  <!-- Alert pour les messages -->
  <div id="alert-container"></div>

  <div class="card">
    <div class="card-header">
      <h5>Cr√©er un nouvel utilisateur</h5>
    </div>
    <div class="card-body">
      <form id="userForm" method="POST">
          <div class="form-group">
              <label for="role" class="form-label">Type d'utilisateur *</label>
              <select id="role" name="role" class="form-select" required>
                  <option value="" selected disabled>Choisissez un r√¥le</option>
                  <option value="patient">Patient</option>
                  <option value="medecin">M√©decin</option>
              </select>
          </div>

          <div class="row">
              <div class="form-group">
                  <label for="nom" class="form-label">Nom *</label>
                  <input type="text" id="nom" name="nom" class="form-control" required />
              </div>
              <div class="form-group">
                  <label for="prenom" class="form-label">Pr√©nom *</label>
                  <input type="text" id="prenom" name="prenom" class="form-control" required />
              </div>
          </div>

          <!-- Num√©ro t√©l√©phone patient -->
          <div class="form-group field-hidden" id="numero-div">
              <label for="numero" class="form-label">Num√©ro de t√©l√©phone *</label>
              <input type="tel" id="numero" name="numero" class="form-control"
                     placeholder="+212 600 123 456" pattern="[+]?[0-9\s\-]+" />
              <div class="form-text">Format: +212 600 123 456</div>
          </div>

          <!-- Sp√©cialit√© m√©decin -->
          <div class="form-group field-hidden" id="specialite-div">
              <label for="specialite" class="form-label">Sp√©cialit√© *</label>
              <input type="text" id="specialite" name="specialite" class="form-control"
                     placeholder="Ex: Cardiologie, P√©diatrie, Neurologie..." />
          </div>

          <!-- Horaires m√©decin -->
          <div class="form-group field-hidden" id="horaires-div">
              <label class="form-label">Horaires disponibles</label>
              <div class="form-text" style="margin-bottom: 1.5rem;">D√©finissez les cr√©neaux de disponibilit√© pour chaque jour. Vous pouvez ajouter plusieurs cr√©neaux par jour.</div>

              <div data-day="lundi" class="day-schedule">
                <strong>üóìÔ∏è Lundi</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="lundi_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="lundi_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('lundi')">+ Ajouter un cr√©neau</button>
              </div>

              <div data-day="mardi" class="day-schedule">
                <strong>üóìÔ∏è Mardi</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="mardi_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="mardi_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('mardi')">+ Ajouter un cr√©neau</button>
              </div>

              <div data-day="mercredi" class="day-schedule">
                <strong>üóìÔ∏è Mercredi</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="mercredi_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="mercredi_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('mercredi')">+ Ajouter un cr√©neau</button>
              </div>

              <div data-day="jeudi" class="day-schedule">
                <strong>üóìÔ∏è Jeudi</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="jeudi_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="jeudi_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('jeudi')">+ Ajouter un cr√©neau</button>
              </div>

              <div data-day="vendredi" class="day-schedule">
                <strong>üóìÔ∏è Vendredi</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="vendredi_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="vendredi_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('vendredi')">+ Ajouter un cr√©neau</button>
              </div>

              <div data-day="samedi" class="day-schedule">
                <strong>üóìÔ∏è Samedi</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="samedi_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="samedi_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('samedi')">+ Ajouter un cr√©neau</button>
              </div>

              <div data-day="dimanche" class="day-schedule">
                <strong>üóìÔ∏è Dimanche</strong>
                <div class="creneaux">
                  <div class="creneau">
                    <input type="time" name="dimanche_start[]" class="form-control">
                    <span>√†</span>
                    <input type="time" name="dimanche_end[]" class="form-control">
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary" onclick="addCreneau('dimanche')">+ Ajouter un cr√©neau</button>
              </div>
          </div>

          <div class="row">
              <div class="form-group">
                  <label for="email" class="form-label">Email *</label>
                  <input type="email" id="email" name="email" class="form-control" required />
                  <div class="form-text">Cet email servira d'identifiant de connexion</div>
              </div>
              <div class="form-group">
                  <label for="mot_de_passe" class="form-label">Mot de passe *</label>
                  <input type="password" id="mot_de_passe" name="mot_de_passe" class="form-control"
                         required minlength="6" />
                  <div class="form-text">Minimum 6 caract√®res</div>
              </div>
          </div>

          <div class="form-actions">
              <button type="submit" class="btn btn-primary" id="submitBtn">
                  <span class="loading spinner-border" role="status"></span>
                  Cr√©er l'utilisateur
              </button>
              <button type="button" class="btn btn-secondary" onclick="resetForm()">R√©initialiser</button>
          </div>
      </form>
    </div>
  </div>
</div>

<script>
  const roleSelect = document.getElementById('role');
  const numeroDiv = document.getElementById('numero-div');
  const specialiteDiv = document.getElementById('specialite-div');
  const horairesDiv = document.getElementById('horaires-div');
  const submitBtn = document.getElementById('submitBtn');
  const loadingSpinner = document.querySelector('.loading');
  const alertContainer = document.getElementById('alert-container');

  // Gestion du changement de r√¥le
  roleSelect.addEventListener('change', () => {
    hideAllFields();

    if(roleSelect.value === 'patient') {
      showPatientFields();
    } else if (roleSelect.value === 'medecin') {
      showMedecinFields();
    }
  });

  function hideAllFields() {
    [numeroDiv, specialiteDiv, horairesDiv].forEach(div => {
      div.classList.remove('field-visible');
      div.classList.add('field-hidden');
    });

    // D√©sactiver les champs requis
    document.getElementById('numero').required = false;
    document.getElementById('specialite').required = false;
    setTimeInputsRequired(false);
  }

  function showPatientFields() {
    setTimeout(() => {
      numeroDiv.classList.remove('field-hidden');
      numeroDiv.classList.add('field-visible');
      document.getElementById('numero').required = true;
    }, 100);
  }

  function showMedecinFields() {
    setTimeout(() => {
      specialiteDiv.classList.remove('field-hidden');
      specialiteDiv.classList.add('field-visible');
      horairesDiv.classList.remove('field-hidden');
      horairesDiv.classList.add('field-visible');
      document.getElementById('specialite').required = true;
      setTimeInputsRequired(true);
    }, 100);
  }

  function setTimeInputsRequired(required) {
    const timeInputs = horairesDiv.querySelectorAll('input[type="time"]');
    timeInputs.forEach(input => {
      input.required = required;
    });
  }

  function addCreneau(day) {
    const dayDiv = document.querySelector(`div[data-day="${day}"] .creneaux`);
    const newCreneau = document.createElement('div');
    newCreneau.classList.add('creneau');
    newCreneau.innerHTML = `
      <input type="time" name="${day}_start[]" class="form-control" required>
      <span>√†</span>
      <input type="time" name="${day}_end[]" class="form-control" required>
      <button type="button" class="btn btn-danger" onclick="removeCreneau(this)" title="Supprimer ce cr√©neau">
        ‚úï
      </button>
    `;
    dayDiv.appendChild(newCreneau);

    // Animation d'entr√©e
    newCreneau.style.opacity = '0';
    newCreneau.style.transform = 'translateY(-10px)';
    setTimeout(() => {
      newCreneau.style.transition = 'all 0.3s ease';
      newCreneau.style.opacity = '1';
      newCreneau.style.transform = 'translateY(0)';
    }, 10);
  }

  function removeCreneau(button) {
    const creneau = button.parentElement;
    const creneauxContainer = creneau.parentElement;

    // Ne pas supprimer s'il n'y a qu'un seul cr√©neau
    if (creneauxContainer.children.length > 1) {
      creneau.style.transition = 'all 0.3s ease';
      creneau.style.opacity = '0';
      creneau.style.transform = 'translateY(-10px)';
      setTimeout(() => creneau.remove(), 300);
    } else {
      showAlert('Vous devez conserver au moins un cr√©neau par jour.', 'warning');
    }
  }

  function showAlert(message, type = 'info') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} fade`;
    alertDiv.innerHTML = `
      ${message}
      <button type="button" class="btn-close" onclick="this.parentElement.remove()">‚úï</button>
    `;
    alertContainer.appendChild(alertDiv);

    // Animation d'entr√©e
    setTimeout(() => alertDiv.classList.add('show'), 10);

    // Auto-hide after 5 seconds
    setTimeout(() => {
      if (alertDiv.parentElement) {
        alertDiv.classList.remove('show');
        setTimeout(() => alertDiv.remove(), 300);
      }
    }, 5000);
  }

  function resetForm() {
    document.getElementById('userForm').reset();
    hideAllFields();
    alertContainer.innerHTML = '';
  }

  function validateTimeSlots() {
    if (roleSelect.value !== 'medecin') return true;

    const days = ['lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi', 'dimanche'];
    let hasValidSlot = false;

    for (const day of days) {
      const startInputs = document.querySelectorAll(`input[name="${day}_start[]"]`);
      const endInputs = document.querySelectorAll(`input[name="${day}_end[]"]`);

      for (let i = 0; i < startInputs.length; i++) {
        const start = startInputs[i].value;
        const end = endInputs[i].value;

        if (start && end) {
          hasValidSlot = true;
          if (start >= end) {
            showAlert(`Erreur dans les horaires du ${day}: l'heure de fin doit √™tre apr√®s l'heure de d√©but.`, 'danger');
            return false;
          }
        }
      }
    }

    if (!hasValidSlot) {
      showAlert('Veuillez d√©finir au moins un cr√©neau horaire.', 'danger');
      return false;
    }

    return true;
  }

  // Gestion de la soumission du formulaire
  document.getElementById('userForm').addEventListener('submit', function(e) {
    e.preventDefault();

    // Validation personnalis√©e
    if (!validateTimeSlots()) {
      return;
    }

    // Afficher le loading
    loadingSpinner.style.display = 'inline-block';
    submitBtn.disabled = true;

    const role = roleSelect.value;
    const formData = new FormData(this);
    const json = {};

    // Conversion FormData vers JSON
    for (const [key, value] of formData.entries()) {
      if (key.endsWith('_start[]') || key.endsWith('_end[]')) {
        const day = key.split('_')[0];
        const type = key.includes('_start[]') ? 'start' : 'end';

        if (!json[day]) {
          json[day] = [];
        }

        const index = formData.getAll(key).indexOf(value);
        if (!json[day][index]) {
          json[day][index] = {};
        }
        json[day][index][type] = value;
      } else {
        if (json[key] !== undefined) {
          if (!Array.isArray(json[key])) {
            json[key] = [json[key]];
          }
          json[key].push(value);
        } else {
          json[key] = value;
        }
      }
    }

    // Nettoyer les horaires pour les m√©decins
    if (role === 'medecin') {
      const days = ['lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi', 'dimanche'];
      const horaires = {};

      days.forEach(day => {
        if (json[day]) {
          const validSlots = json[day].filter(slot => slot.start && slot.end);
          if (validSlots.length > 0) {
            horaires[day] = validSlots;
          }
          delete json[day];
        }
      });

      json.horaires = horaires;
    }

    // Simulation d'envoi (remplacez par votre logique)
    setTimeout(() => {
      showAlert(`${role.charAt(0).toUpperCase() + role.slice(1)} cr√©√© avec succ√®s !`, 'success');
      resetForm();
      loadingSpinner.style.display = 'none';
      submitBtn.disabled = false;
    }, 2000);

    /*
    // Code original pour l'envoi r√©el
    fetch(`/${role}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(json)
    })
    .then(response => {
        if (!response.ok) {
          return response.json().then(err => {
            throw new Error(err.error || `Erreur HTTP ${response.status}`);
          });
        }
        return response.json();
    })
    .then(data => {
        showAlert(`${role.charAt(0).toUpperCase() + role.slice(1)} cr√©√© avec succ√®s ! ID: ${data.id}`, 'success');
        resetForm();
    })
    .catch(error => {
        console.error('Erreur:', error);
        showAlert(`Erreur lors de la cr√©ation: ${error.message}`, 'danger');
    })
    .finally(() => {
        loadingSpinner.style.display = 'none';
        submitBtn.disabled = false;
    });
    */
  });

  // Validation en temps r√©el de l'email
  document.getElementById('email').addEventListener('blur', function() {
    const email = this.value;
    if (email && !email.includes('@')) {
      showAlert('Format d\'email invalide', 'warning');
    }
  });
</script>

</body>
</html>